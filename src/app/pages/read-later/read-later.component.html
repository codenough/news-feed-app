<div class="read-later-container">
  <header class="read-later-header">
    <div class="header-left">
      <button
        nz-button
        nzType="text"
        nzSize="default"
        (click)="goBack()"
        aria-label="Go back to main feed"
        class="back-btn"
      >
        <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
        <span>Back to Feed</span>
      </button>
      <h1 class="page-title">
        <span nz-icon nzType="clock-circle" nzTheme="outline" class="title-icon"></span>
        Read Later
        @if (readLaterCount() > 0) {
          <nz-badge
            [nzCount]="readLaterCount()"
            [nzShowZero]="false"
            class="title-count-badge"
          ></nz-badge>
        }
      </h1>
    </div>

    <div class="header-actions">
      <button
        nz-button
        nzType="primary"
        nzSize="default"
        (click)="openAddModal()"
        aria-label="Add external article"
        class="add-article-btn"
      >
        <span nz-icon nzType="plus-circle" nzTheme="outline"></span>
        Add Article
      </button>

      @if (readLaterCount() > 0) {
        <button
          nz-button
          nzType="default"
          nzSize="default"
          (click)="clearAllReadLater()"
          aria-label="Clear all read later articles"
        >
          <span nz-icon nzType="close-circle" nzTheme="outline"></span>
          Clear All
        </button>
      }
    </div>
  </header>

  <main class="read-later-content">
    @if (readLaterCount() === 0) {
      <div class="empty-state">
        <span nz-icon nzType="clock-circle" nzTheme="outline" class="empty-icon"></span>
        <h2 class="empty-title">No articles in Read Later</h2>
        <p class="empty-message">
          Articles you save to read later will appear here. Click the clock icon on any article to add it to this list, or paste external URLs above.
        </p>
        <button nz-button nzType="primary" (click)="goBack()">
          Browse Articles
        </button>
      </div>
    } @else {
      <!-- External Articles Section -->
      @if (externalArticles().length > 0) {
        <section class="articles-section">
          <div class="section-header">
            <h2 class="section-title">
              <span nz-icon nzType="link" nzTheme="outline" class="section-icon"></span>
              External Links
              @if (externalArticles().length > 0) {
                <nz-badge
                  [nzCount]="externalArticles().length"
                  [nzShowZero]="false"
                  class="section-count-badge"
                ></nz-badge>
              }
            </h2>
            @if (externalArticles().length > 0) {
              <button
                nz-button
                nzType="text"
                nzSize="small"
                (click)="clearExternalArticles()"
                aria-label="Clear external articles"
                class="clear-section-btn"
              >
                <span nz-icon nzType="close-circle" nzTheme="outline"></span>
                Clear All
              </button>
            }
          </div>
          <div class="news-feed" [class.news-feed--list]="viewMode() === 'list'">
            @for (article of externalArticlesAsNews(); track article.id) {
              <app-news-card
                [article]="article"
                [viewMode]="viewMode()"
                (cardClick)="onCardClick($event)"
                (bookmarkToggle)="onBookmarkToggle($event)"
                (readLaterToggle)="onReadLaterToggle($event)"
                (markRead)="onMarkRead($event)"
                (markUnread)="onMarkUnread($event)"
                (skip)="onSkip($event)"
                (undoSkip)="onUndoSkip($event)"
              />
            }
          </div>
        </section>
      }

      <!-- Internal Articles Section -->
      @if (internalReadLaterArticles().length > 0) {
        <section class="articles-section">
          <div class="section-header">
            <h2 class="section-title">
              <span nz-icon nzType="file-text" nzTheme="outline" class="section-icon"></span>
              Saved Articles
              @if (internalReadLaterArticles().length > 0) {
                <nz-badge
                  [nzCount]="internalReadLaterArticles().length"
                  [nzShowZero]="false"
                  class="section-count-badge"
                ></nz-badge>
              }
            </h2>
            @if (internalReadLaterArticles().length > 0) {
              <button
                nz-button
                nzType="text"
                nzSize="small"
                (click)="clearInternalArticles()"
                aria-label="Clear saved articles"
                class="clear-section-btn"
              >
                <span nz-icon nzType="close-circle" nzTheme="outline"></span>
                Clear All
              </button>
            }
          </div>
          <div class="news-feed" [class.news-feed--list]="viewMode() === 'list'">
            @for (article of internalReadLaterArticles(); track article.id) {
              <app-news-card
                [article]="article"
                [viewMode]="viewMode()"
                (cardClick)="onCardClick($event)"
                (bookmarkToggle)="onBookmarkToggle($event)"
                (readLaterToggle)="onReadLaterToggle($event)"
                (markRead)="onMarkRead($event)"
                (markUnread)="onMarkUnread($event)"
                (skip)="onSkip($event)"
                (undoSkip)="onUndoSkip($event)"
              />
            }
          </div>
        </section>
      }
    }
  </main>

  <app-add-external-article-modal
    (articleAdded)="onArticleAdded($event)"
  />
</div>
