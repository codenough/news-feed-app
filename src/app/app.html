<div class="app-container">
  <header class="app-header">
    <div class="header-content">
      <h1 class="app-title">{{ title() }}</h1>

      <div class="search-container">
        <nz-input-group [nzPrefix]="prefixIconSearch" [nzSuffix]="suffixIconClear">
          <input
            nz-input
            type="text"
            placeholder="Search articles..."
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchChange($event)"
            aria-label="Search articles by title or description"
          />
        </nz-input-group>
        <ng-template #prefixIconSearch>
          <span nz-icon nzType="search" nzTheme="outline"></span>
        </ng-template>
        <ng-template #suffixIconClear>
          @if (searchQuery()) {
            <span
              nz-icon
              nzType="close-circle"
              nzTheme="fill"
              class="search-clear-icon"
              (click)="onSearchClear()"
              aria-label="Clear search"
            ></span>
          }
        </ng-template>
      </div>

      <div class="header-actions">
        <div class="filter-controls">
          <button
            nz-button
            nzSize="default"
            [nzType]="currentFilter() === 'all' ? 'primary' : 'default'"
            (click)="onFilterChange('all')"
            aria-label="Show all articles"
          >
            All
          </button>
          <button
            nz-button
            nzSize="default"
            [nzType]="currentFilter() === 'unread' ? 'primary' : 'default'"
            (click)="onFilterChange('unread')"
            aria-label="Show unread articles"
          >
            Unread
          </button>
          <button
            nz-button
            nzSize="default"
            [nzType]="currentFilter() === 'read' ? 'primary' : 'default'"
            (click)="onFilterChange('read')"
            aria-label="Show read articles"
          >
            Read
          </button>
          <button
            nz-button
            nzSize="default"
            [nzType]="currentFilter() === 'bookmarked' ? 'primary' : 'default'"
            (click)="onFilterChange('bookmarked')"
            aria-label="Show bookmarked articles"
          >
            Bookmarked
          </button>
        </div>
        <div class="header-controls">
          <button
            nz-button
            nzSize="default"
            (click)="toggleSort()"
            [attr.aria-label]="sortOrder() === 'desc' ? 'Sort by oldest first' : 'Sort by latest first'"
            [title]="sortOrder() === 'desc' ? 'Sort by oldest' : 'Sort by latest'"
            class="sort-toggle-btn"
          >
            @if (sortOrder() === 'desc') {
              <span nz-icon nzType="sort-descending" nzTheme="outline"></span>
              <span class="sort-label">Latest</span>
            } @else {
              <span nz-icon nzType="sort-ascending" nzTheme="outline"></span>
              <span class="sort-label">Oldest</span>
            }
          </button>

          <button
            nz-button
            nzSize="default"
            nzShape="circle"
            (click)="onRefresh()"
            [nzLoading]="isLoading()"
            [disabled]="isLoading()"
            aria-label="Refresh feed"
            title="Refresh feed"
            class="refresh-btn"
          >
            <span nz-icon nzType="reload" nzTheme="outline"></span>
          </button>

          @if (lastFetchTimestamp()) {
            <span class="last-updated">
              Last updated: {{ getFormattedTimestamp() }}
            </span>
          }
        </div>

        <div class="header-actions-right">
          <button
            nz-button
            nzSize="default"
            nzShape="circle"
            (click)="toggleViewMode()"
            [attr.aria-label]="viewMode() === 'grid' ? 'Switch to list view' : 'Switch to grid view'"
            class="view-toggle-btn"
          >
            @if (viewMode() === 'grid') {
              <span nz-icon nzType="unordered-list" nzTheme="outline"></span>
            } @else {
              <span nz-icon nzType="appstore" nzTheme="outline"></span>
            }
          </button>
          <app-theme-toggle />
        </div>
      </div>
    </div>
  </header>

  <div class="app-content">
    <aside class="app-sidebar">
      <div class="sidebar-section">
        <h3 class="sidebar-title">Sources</h3>
        <ul class="source-list">
          <li class="source-item">
            <button
              nz-button
              nzType="text"
              nzSize="default"
              class="source-btn"
              [class.source-btn--active]="selectedSource() === null"
              (click)="onSourceSelect(null)"
              aria-label="Show articles from all sources"
            >
              <span class="source-name">All Sources</span>
            </button>
          </li>
          @for (source of sources(); track source.name) {
            <li class="source-item">
              <button
                nz-button
                nzType="text"
                nzSize="default"
                class="source-btn"
                [class.source-btn--active]="selectedSource() === source.name"
                (click)="onSourceSelect(source.name)"
                [attr.aria-label]="'Show articles from ' + source.name"
              >
                <span class="source-name">{{ source.name }}</span>
                @if (source.unreadCount > 0) {
                  <span class="unread-badge" [attr.aria-label]="source.unreadCount + ' unread articles'">
                    {{ source.unreadCount }}
                  </span>
                }
              </button>
            </li>
          }
        </ul>
      </div>

      <div class="sidebar-section">
        <app-date-range-filter (dateRangeChange)="onDateRangeChange($event)" />
      </div>
    </aside>

  <main class="app-main">
    @if (error()) {
      <div class="error-message">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <p>{{ error() }}</p>
        <button nz-button nzType="primary" (click)="onRefresh()">
          Retry
        </button>
      </div>
    }

    @if (isLoading()) {
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading articles...</p>
      </div>
    }

    @if (!isLoading() && !error() && articles().length === 0) {
      <div class="no-results-container">
        <svg class="no-results-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
          <line x1="11" y1="8" x2="11" y2="14"/>
          <line x1="8" y1="11" x2="14" y2="11"/>
        </svg>
        <h2 class="no-results-title">No articles found</h2>
        <p class="no-results-message">
          @if (searchQuery()) {
            No articles match your search "<strong>{{ searchQuery() }}</strong>".
          } @else if (currentFilter() === 'unread') {
            You have no unread articles.
          } @else if (currentFilter() === 'read') {
            You have no read articles yet.
          } @else if (currentFilter() === 'bookmarked') {
            You haven't bookmarked any articles yet.
          } @else {
            No articles available at the moment.
          }
        </p>
        @if (searchQuery() || currentFilter() !== 'all' || selectedSource()) {
          <button nz-button nzType="default" (click)="onClearFilters()">
            <span nz-icon nzType="close-circle" nzTheme="outline"></span>
            Clear filters
          </button>
        }
      </div>
    }

    <div class="news-feed" [class.news-feed--list]="viewMode() === 'list'">
      @for (article of articles(); track article.id) {
        <app-news-card
          [article]="article"
          [viewMode]="viewMode()"
          (cardClick)="onCardClick($event)"
          (bookmarkToggle)="onBookmarkToggle($event)"
          (readLaterToggle)="onReadLaterToggle($event)"
          (menuAction)="onMenuAction($event)"
        />
      }
    </div>
  </main>
  </div>
</div>

