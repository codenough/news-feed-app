<div class="app-container">
  <header class="app-header">
    <div class="header-content">
      <h1 class="app-title">{{ title() }}</h1>

      <div class="search-container">
        <span class="search-prefix-icon" nz-icon nzType="search" nzTheme="outline"></span>
        <input
          nz-input
          type="text"
          placeholder="Search articles..."
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange($event)"
          aria-label="Search articles by title or description"
          class="search-input"
        />
        @if (searchQuery()) {
          <span
            nz-icon
            nzType="close-circle"
            nzTheme="fill"
            class="search-clear-icon"
            (click)="onSearchClear()"
            aria-label="Clear search"
          ></span>
        }
      </div>

      <div class="header-actions">
        <div class="filter-controls">
          <button
            nz-button
            nzSize="default"
            [nzType]="currentFilter() === 'all' ? 'primary' : 'default'"
            (click)="onFilterChange('all')"
            aria-label="Show all articles"
          >
            All
          </button>
          <button
            nz-button
            nzSize="default"
            [nzType]="currentFilter() === 'unread' ? 'primary' : 'default'"
            (click)="onFilterChange('unread')"
            aria-label="Show unread articles"
          >
            Unread
          </button>
          <button
            nz-button
            nzSize="default"
            [nzType]="currentFilter() === 'read' ? 'primary' : 'default'"
            (click)="onFilterChange('read')"
            aria-label="Show read articles"
          >
            Read
          </button>
          <button
            nz-button
            nzSize="default"
            [nzType]="currentFilter() === 'bookmarked' ? 'primary' : 'default'"
            (click)="onFilterChange('bookmarked')"
            aria-label="Show bookmarked articles"
          >
            Bookmarked
          </button>
        </div>
        <div class="header-controls">
          <nz-badge [nzCount]="readLaterCount()" [nzShowZero]="false" class="read-later-badge">
            <button
              nz-button
              nzType="default"
              nzSize="default"
              (click)="navigateToReadLater()"
              aria-label="View read later articles"
              title="Read Later"
              class="read-later-btn"
            >
              <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
              <span class="btn-label">Read Later</span>
            </button>
          </nz-badge>

          <button
            nz-button
            nzType="default"
            nzSize="default"
            (click)="toggleSort()"
            [attr.aria-label]="sortOrder() === 'desc' ? 'Sort by oldest first' : 'Sort by latest first'"
            [title]="sortOrder() === 'desc' ? 'Sort by oldest' : 'Sort by latest'"
            class="sort-toggle-btn"
          >
            @if (sortOrder() === 'desc') {
              <span nz-icon nzType="sort-descending" nzTheme="outline"></span>
              <span class="btn-label">Latest</span>
            } @else {
              <span nz-icon nzType="sort-ascending" nzTheme="outline"></span>
              <span class="btn-label">Oldest</span>
            }
          </button>

          <button
            nz-button
            nzSize="default"
            nzShape="circle"
            (click)="onRefresh()"
            [nzLoading]="isLoading()"
            [disabled]="isLoading()"
            aria-label="Refresh feed"
            title="Refresh feed"
            class="refresh-btn"
          >
            <span nz-icon nzType="reload" nzTheme="outline"></span>
          </button>

          @if (lastFetchTimestamp()) {
            <span class="last-updated">
              Last updated: {{ getFormattedTimestamp() }}
            </span>
          }
        </div>

        <div class="header-actions-right">
          <button
            nz-button
            nzType="default"
            nzSize="default"
            routerLink="/admin"
            aria-label="Admin Dashboard"
            title="Admin Dashboard"
          >
            <span nz-icon nzType="setting" nzTheme="outline"></span>
            <span class="btn-label">Admin</span>
          </button>

          <button
            nz-button
            nzSize="default"
            nzShape="circle"
            (click)="toggleViewMode()"
            [attr.aria-label]="viewMode() === 'grid' ? 'Switch to list view' : 'Switch to grid view'"
            class="view-toggle-btn"
          >
            @if (viewMode() === 'grid') {
              <span nz-icon nzType="unordered-list" nzTheme="outline"></span>
            } @else {
              <span nz-icon nzType="appstore" nzTheme="outline"></span>
            }
          </button>
          <app-theme-toggle />
        </div>
      </div>
    </div>
  </header>

  <div class="app-content">
    <aside class="app-sidebar">
      <div class="sidebar-section">
        <h3 class="sidebar-title">Sources</h3>
        <ul class="source-list">
          <li class="source-item">
            <button
              nz-button
              nzType="text"
              nzSize="default"
              class="source-btn"
              [class.source-btn--active]="selectedSource() === null"
              (click)="onSourceSelect(null)"
              aria-label="Show articles from all sources"
            >
              <span class="source-name">All Sources</span>
            </button>
          </li>
          @for (source of sources(); track source.name) {
            <li class="source-item">
              <button
                nz-button
                nzType="text"
                nzSize="default"
                class="source-btn"
                [class.source-btn--active]="selectedSource() === source.name"
                (click)="onSourceSelect(source.name)"
                [attr.aria-label]="'Show articles from ' + source.name"
              >
                <span class="source-name">{{ source.name }}</span>
                @if (source.unreadCount > 0) {
                  <span class="unread-badge" [attr.aria-label]="source.unreadCount + ' unread articles'">
                    {{ source.unreadCount }}
                  </span>
                }
              </button>
            </li>
          }
        </ul>
      </div>

      <div class="sidebar-section">
        <app-date-range-filter (dateRangeChange)="onDateRangeChange($event)" />
      </div>
    </aside>

    <main class="app-main">
      <router-outlet />
    </main>
  </div>
</div>
